<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0a0a0f">
<title>IELTS Speaking Practice</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ¤</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,700;1,9..40,400&family=JetBrains+Mono:wght@400;700&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{overscroll-behavior:none;-webkit-text-size-adjust:100%}
body{background:#0a0a0f;color:#fff;font-family:'DM Sans',sans-serif;min-height:100vh;min-height:100dvh;overflow-x:hidden}
::-webkit-scrollbar{width:0;display:none}
.app{min-height:100vh;min-height:100dvh;display:flex;flex-direction:column;position:relative}
.bg{position:fixed;inset:0;pointer-events:none;z-index:0}
.cnt{position:relative;z-index:1;flex:1;display:flex;flex-direction:column;max-width:480px;margin:0 auto;width:100%;padding:env(safe-area-inset-top,20px) 20px calc(env(safe-area-inset-bottom,16px)+16px)}
.fi{opacity:0;transform:translateY(16px);animation:fi .6s cubic-bezier(.16,1,.3,1) forwards}
@keyframes fi{to{opacity:1;transform:translateY(0)}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes rec-pulse{0%,100%{box-shadow:0 0 20px rgba(255,107,107,.3)}50%{box-shadow:0 0 50px rgba(255,107,107,.6)}}
.mono{font-family:'JetBrains Mono',monospace}
.serif{font-family:'Playfair Display',serif}
.btn{border:none;cursor:pointer;font-family:'DM Sans',sans-serif;transition:all .2s;-webkit-user-select:none;user-select:none;touch-action:manipulation}
.btn:active{transform:scale(.97)}
@supports(padding:env(safe-area-inset-top)){.cnt{padding-top:calc(env(safe-area-inset-top)+16px);padding-bottom:calc(env(safe-area-inset-bottom)+16px)}}
</style>
</head>
<body>
<div id="root"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<script type="text/babel">
const {useState,useEffect,useRef,useCallback}=React;

const P1=[
{topic:"Home & Accommodation",questions:["Do you live in a house or an apartment?","What is your favourite room in your home? Why?","Would you like to move to a different home in the future?","What kind of housing is most popular in your country?"]},
{topic:"Work & Studies",questions:["Do you work or are you a student?","What do you like most about your work/studies?","Would you like to change your job/field of study in the future?","What skills have you gained from your work/studies?"]},
{topic:"Hobbies & Free Time",questions:["What do you enjoy doing in your free time?","How did you become interested in this hobby?","Do you think hobbies are important? Why?","Would you like to take up a new hobby in the future?"]},
{topic:"Travel & Transport",questions:["How do you usually travel to work or school?","Do you prefer public transport or private transport? Why?","What is the most interesting place you have visited?","Would you like to travel more in the future?"]},
{topic:"Food & Cooking",questions:["What kind of food do you like to eat?","Do you prefer eating at home or eating out?","Have you ever tried cooking a dish from another country?","Is there a food you disliked as a child but enjoy now?"]},
{topic:"Technology",questions:["How often do you use your phone?","What technology do you use most in your daily life?","Do you think people rely too much on technology?","What new technology would you like to try?"]},
{topic:"Weather & Seasons",questions:["What is the weather like in your country?","Which season do you like the most? Why?","Does the weather affect your mood?","What do you usually do on rainy days?"]},
{topic:"Friends & Social Life",questions:["Do you prefer having a few close friends or many friends?","How do you usually keep in touch with your friends?","What qualities do you value most in a friend?","Do you think it is easier to make friends now than in the past?"]},
];

const P2=[
{topic:"Describe a person who has influenced you",points:["Who this person is","How you know this person","What this person has done to influence you","And explain why this person has had such an influence on you"]},
{topic:"Describe a place you would like to visit",points:["Where the place is","How you learned about it","What you would like to do there","And explain why you would like to visit this place"]},
{topic:"Describe a skill you would like to learn",points:["What the skill is","Why you want to learn it","How you would learn it","And explain how this skill would benefit you"]},
{topic:"Describe a memorable event in your life",points:["When the event took place","Where it happened","What happened during the event","And explain why it was memorable for you"]},
{topic:"Describe a book or film that made an impression on you",points:["What the book/film was about","When you read/watched it","Why you chose it","And explain what impression it made on you"]},
{topic:"Describe a time when you helped someone",points:["Who you helped","What you helped them with","How you felt about helping them","And explain why you decided to help this person"]},
];

const P3={
"Describe a person who has influenced you":["Do you think famous people have more influence on young people than parents?","What qualities make a good role model?","How has the concept of influence changed with social media?","Should schools teach students about influential historical figures?"],
"Describe a place you would like to visit":["Why do people enjoy travelling to unfamiliar places?","How has tourism changed in recent years?","Do you think travelling helps people become more open-minded?","What impact does mass tourism have on local communities?"],
"Describe a skill you would like to learn":["What skills do you think will be most important in the future?","Is it better to have many skills or to specialise in one?","How has technology changed the way people learn new skills?","Do you think schools prepare students with the right skills for work?"],
"Describe a memorable event in your life":["Why do people tend to remember certain events more than others?","Do you think shared experiences bring people closer together?","How has the way people record memories changed over time?","Are celebrations and events more important now than in the past?"],
"Describe a book or film that made an impression on you":["Do you think reading books is more beneficial than watching films?","How do books and films shape people's understanding of the world?","Why are some stories popular across different cultures?","Do you think AI-generated content will replace human creativity?"],
"Describe a time when you helped someone":["Do you think people are less willing to help others than in the past?","Should governments do more to encourage volunteering?","Is it better to help people financially or through personal effort?","How can communities encourage a culture of helping each other?"],
};

const CHECKLIST=[
  {cat:"Fluency & Coherence",items:["é€”åˆ‡ã‚Œãšã«è©±ã—ç¶šã‘ã‚‰ã‚ŒãŸ","æ¥ç¶šè©ï¼ˆhowever, because, for exampleï¼‰ã‚’ä½¿ãˆãŸ","è«–ç†çš„ãªé †åºã§è©±ã‚’æ§‹æˆã§ããŸ","ä¸è‡ªç„¶ãªé–“ã‚„ç¹°ã‚Šè¿”ã—ãŒå°‘ãªã‹ã£ãŸ"]},
  {cat:"Lexical Resource",items:["åŒã˜å˜èªã®ç¹°ã‚Šè¿”ã—ã‚’é¿ã‘ãŸ","ãƒˆãƒ”ãƒƒã‚¯ã«åˆã£ãŸèªå½™ã‚’ä½¿ãˆãŸ","è¨€ã„æ›ãˆï¼ˆparaphraseï¼‰ãŒã§ããŸ","ã‚¤ãƒ‡ã‚£ã‚ªãƒ ã‚„ã‚³ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ãˆãŸ"]},
  {cat:"Grammatical Range & Accuracy",items:["è¤‡æ•°ã®æ–‡æ³•æ§‹é€ ã‚’ä½¿ã£ãŸï¼ˆè¤‡æ–‡ãƒ»å—å‹•æ…‹ãªã©ï¼‰","æ™‚åˆ¶ã‚’æ­£ã—ãä½¿ã„åˆ†ã‘ãŸ","å† è©ãƒ»å‰ç½®è©ã®ãƒŸã‚¹ãŒå°‘ãªã‹ã£ãŸ","æ¡ä»¶æ–‡ã‚„ä»®å®šæ³•ã‚’ä½¿ãˆãŸ"]},
  {cat:"Pronunciation",items:["ã¯ã£ãã‚Šèãå–ã‚Œã‚‹ç™ºéŸ³ã ã£ãŸ","ã‚¤ãƒ³ãƒˆãƒãƒ¼ã‚·ãƒ§ãƒ³ã«å¼·å¼±ãŒã‚ã£ãŸ","å˜èªã®ã‚¹ãƒˆãƒ¬ã‚¹ä½ç½®ãŒæ­£ã—ã‹ã£ãŸ","è‡ªç„¶ãªãƒªã‚ºãƒ ã§è©±ã›ãŸ"]},
];

function tts(text,onEnd){
  if(!window.speechSynthesis)return;
  window.speechSynthesis.cancel();
  const u=new SpeechSynthesisUtterance(text);
  u.lang="en-US";u.rate=0.9;u.pitch=1;
  const v=window.speechSynthesis.getVoices();
  const p=v.find(x=>x.lang.startsWith("en")&&/Google|Samantha|Daniel|Karen|Natural/.test(x.name));
  if(p)u.voice=p;else{const e=v.find(x=>x.lang.startsWith("en"));if(e)u.voice=e;}
  if(onEnd)u.onend=onEnd;
  window.speechSynthesis.speak(u);
}

function Timer({sec,max,label,color}){
  const m=Math.floor(sec/60),s=sec%60;
  return(
    <div style={{display:"flex",alignItems:"center",gap:10}}>
      <span className="mono" style={{fontSize:26,fontWeight:700,color,letterSpacing:2,minWidth:74}}>{String(m).padStart(2,"0")}:{String(s).padStart(2,"0")}</span>
      <div style={{flex:1,height:5,background:"rgba(255,255,255,.08)",borderRadius:3,overflow:"hidden"}}>
        <div style={{width:`${(sec/max)*100}%`,height:"100%",background:color,borderRadius:3,transition:"width 1s linear"}}/>
      </div>
      <span style={{fontSize:10,color:"rgba(255,255,255,.4)",textTransform:"uppercase",letterSpacing:1.5,fontWeight:600}}>{label}</span>
    </div>
  );
}

// Waveform from MediaRecorder analyser
function Waveform({aRef,active,color}){
  const cRef=useRef(null);const rRef=useRef(null);
  useEffect(()=>{
    const c=cRef.current;if(!c)return;
    const ctx=c.getContext("2d"),W=c.width,H=c.height,bars=28,bw=W/bars-2;
    const draw=()=>{
      ctx.clearRect(0,0,W,H);
      const a=aRef?.current;
      if(a&&active){
        const d=new Uint8Array(a.frequencyBinCount);a.getByteFrequencyData(d);
        const step=Math.max(1,Math.floor(d.length/bars));
        for(let i=0;i<bars;i++){const v=d[i*step]/255,h=Math.max(3,v*H);ctx.fillStyle=color;ctx.globalAlpha=.5+v*.5;ctx.beginPath();ctx.roundRect(i*(bw+2),H/2-h/2,bw,h,2);ctx.fill();}
      }else{
        for(let i=0;i<bars;i++){ctx.fillStyle="rgba(255,255,255,.08)";ctx.beginPath();ctx.roundRect(i*(bw+2),H/2-1.5,bw,3,2);ctx.fill();}
      }
      rRef.current=requestAnimationFrame(draw);
    };
    draw();return()=>cancelAnimationFrame(rRef.current);
  },[active,color]);
  return <canvas ref={cRef} width={280} height={44} style={{width:"100%",maxWidth:280,height:44}}/>;
}

function App(){
  const[scr,setScr]=useState("home");
  const[part,setPart]=useState(0);
  const[qi,setQi]=useState(0);
  const[sec,setSec]=useState(0);
  const[tOn,setTOn]=useState(false);
  const[s1,setS1]=useState(null);
  const[s2,setS2]=useState(null);
  const[prepS,setPrepS]=useState(60);
  const[prep,setPrep]=useState(false);
  const[rec,setRec]=useState(false);
  const[tips,setTips]=useState(false);
  const[aKey,setAKey]=useState(0);
  const[spk,setSpk]=useState(false);
  const[ar,setAr]=useState(true);

  // Recording state
  const[micRec,setMicRec]=useState(false);
  const[micErr,setMicErr]=useState(null);
  const[recordings,setRecordings]=useState([]); // {part,qi,url,duration}
  const[playingIdx,setPlayingIdx]=useState(null);

  // Self-eval
  const[checks,setChecks]=useState({});

  const tR=useRef(null);const pR=useRef(null);
  const mrRef=useRef(null); // MediaRecorder
  const anRef=useRef(null); // AnalyserNode
  const acRef=useRef(null); // AudioContext
  const stRef=useRef(null); // MediaStream
  const chunks=useRef([]);
  const recStart=useRef(null);
  const audioElRef=useRef(null);

  useEffect(()=>{if(window.speechSynthesis){window.speechSynthesis.getVoices();window.speechSynthesis.onvoiceschanged=()=>window.speechSynthesis.getVoices();}},[]);
  useEffect(()=>{setAKey(k=>k+1);},[scr,part,qi]);
  useEffect(()=>{if(scr==="test"&&!s1){setS1(P1[Math.floor(Math.random()*P1.length)]);setS2(P2[Math.floor(Math.random()*P2.length)]);}},[scr]);
  useEffect(()=>{if(tOn)tR.current=setInterval(()=>setSec(t=>t+1),1000);return()=>clearInterval(tR.current);},[tOn]);
  useEffect(()=>{
    if(prep&&prepS>0){pR.current=setInterval(()=>{setPrepS(t=>{if(t<=1){setPrep(false);setRec(true);setTOn(true);setSec(0);return 0;}return t-1;});},1000);}
    return()=>clearInterval(pR.current);
  },[prep,prepS]);
  useEffect(()=>()=>{stopMic();window.speechSynthesis?.cancel();},[]);

  const startMic=async()=>{
    try{
      const stream=await navigator.mediaDevices.getUserMedia({audio:true});
      stRef.current=stream;
      // Analyser
      const ctx=new(window.AudioContext||window.webkitAudioContext)();acRef.current=ctx;
      const src=ctx.createMediaStreamSource(stream);const a=ctx.createAnalyser();a.fftSize=256;src.connect(a);anRef.current=a;
      // MediaRecorder
      const mr=new MediaRecorder(stream,{mimeType:MediaRecorder.isTypeSupported('audio/webm')?'audio/webm':'audio/mp4'});
      chunks.current=[];
      mr.ondataavailable=(e)=>{if(e.data.size>0)chunks.current.push(e.data);};
      mr.onstop=()=>{
        const blob=new Blob(chunks.current,{type:mr.mimeType});
        const url=URL.createObjectURL(blob);
        const dur=Math.round((Date.now()-recStart.current)/1000);
        setRecordings(prev=>[...prev,{part,qi,url,duration:dur}]);
        chunks.current=[];
      };
      mr.start();
      recStart.current=Date.now();
      mrRef.current=mr;
      setMicRec(true);setMicErr(null);
    }catch(e){
      console.error(e);
      setMicErr("ãƒã‚¤ã‚¯ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸã€‚è¨­å®šã‹ã‚‰ãƒã‚¤ã‚¯ã‚’è¨±å¯ã—ã¦ãã ã•ã„ã€‚");
    }
  };

  const stopMic=useCallback(()=>{
    if(mrRef.current&&mrRef.current.state==="recording"){try{mrRef.current.stop();}catch(e){}}
    mrRef.current=null;
    if(stRef.current){stRef.current.getTracks().forEach(t=>t.stop());stRef.current=null;}
    if(acRef.current){acRef.current.close().catch(()=>{});acRef.current=null;}
    anRef.current=null;
    setMicRec(false);
  },[]);

  const playRec=(idx)=>{
    if(audioElRef.current){audioElRef.current.pause();audioElRef.current=null;}
    if(playingIdx===idx){setPlayingIdx(null);return;}
    const a=new Audio(recordings[idx].url);
    a.onended=()=>setPlayingIdx(null);
    a.play();audioElRef.current=a;setPlayingIdx(idx);
  };

  const readQ=(t)=>{setSpk(true);tts(t,()=>setSpk(false));};
  const getQs=()=>{if(part===1&&s1)return s1.questions;if(part===3&&s2)return P3[s2.topic]||[];return[];};
  const pc=part===1?"#4ECDC4":part===2?"#FF6B6B":"#FFE66D";
  const maxT=part===2?120:300;

  const start=()=>{setScr("test");setPart(1);setQi(0);setSec(0);setTOn(false);setRec(false);setS1(null);setS2(null);setMicErr(null);setRecordings([]);setChecks({});};

  const saveStop=()=>{stopMic();setRec(false);setTOn(false);window.speechSynthesis?.cancel();setSpk(false);};

  const nxt=()=>{saveStop();const qs=getQs();if(qi<qs.length-1){setQi(i=>i+1);setSec(0);}else{if(part===1){setPart(2);setQi(0);setSec(0);setPrep(true);setPrepS(60);}else if(part===2){setPart(3);setQi(0);setSec(0);}else{setScr("review");}}};
  const skp=()=>{saveStop();if(part===1){setPart(2);setQi(0);setSec(0);setPrep(true);setPrepS(60);}else if(part===2){setPart(3);setQi(0);setSec(0);}else{setScr("review");}};
  const stRec=()=>{setRec(true);setTOn(true);setSec(0);startMic();if(ar){const qs=getQs();const q=part===2?s2?.topic:qs[qi];if(q)readQ(part===2?`Please talk about: ${q}`:q);}};
  const skPrep=()=>{clearInterval(pR.current);setPrep(false);setRec(true);setTOn(true);setSec(0);setPrepS(0);startMic();};

  const toggleCheck=(cat,i)=>{const k=`${cat}-${i}`;setChecks(c=>({...c,[k]:!c[k]}));};
  const getScore=()=>{const total=CHECKLIST.reduce((s,c)=>s+c.items.length,0);const checked=Object.values(checks).filter(Boolean).length;return Math.round((checked/total)*100);};
  const getBand=()=>{const s=getScore();if(s>=90)return"7.0â€“8.0";if(s>=75)return"6.0â€“7.0";if(s>=55)return"5.0â€“6.0";if(s>=35)return"4.0â€“5.0";return"3.0â€“4.0";};

  // â•â•â• HOME â•â•â•
  if(scr==="home") return(
    <div className="app">
      <div className="bg" style={{background:"radial-gradient(ellipse at 20% 50%,rgba(78,205,196,.08) 0%,transparent 60%),radial-gradient(ellipse at 80% 20%,rgba(255,107,107,.06) 0%,transparent 50%),radial-gradient(ellipse at 50% 80%,rgba(255,230,109,.04) 0%,transparent 50%)"}}/>
      <div className="cnt fi" key={aKey} style={{alignItems:"center",justifyContent:"center"}}>
        <div style={{display:"flex",alignItems:"center",gap:10,marginBottom:14}}>
          <div style={{width:44,height:44,borderRadius:12,background:"linear-gradient(135deg,#4ECDC4,#FF6B6B,#FFE66D)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:20}}>ğŸ¤</div>
          <span style={{fontSize:12,fontWeight:700,letterSpacing:3.5,textTransform:"uppercase",color:"rgba(255,255,255,.35)"}}>IELTS SPEAKING</span>
        </div>
        <h1 className="serif" style={{fontSize:46,fontWeight:900,textAlign:"center",lineHeight:1.1,marginBottom:14,background:"linear-gradient(135deg,#fff 30%,rgba(255,255,255,.6))",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"}}>Speaking<br/>Practice</h1>
        <p style={{fontSize:14,color:"rgba(255,255,255,.45)",textAlign:"center",lineHeight:1.7,maxWidth:360,marginBottom:28}}>
          æœ¬ç•ªã•ãªãŒã‚‰ã®ç’°å¢ƒã§ Part 1ã€œ3 ã‚’é€šã—ç·´ç¿’ã€‚<br/>ãƒã‚¤ã‚¯ã§éŒ²éŸ³ã—ã¦è‡ªåˆ†ã®å›ç­”ã‚’æŒ¯ã‚Šè¿”ã‚Œã¾ã™ã€‚
        </p>

        <div style={{display:"flex",flexDirection:"column",gap:10,width:"100%",marginBottom:36}}>
          {[{n:1,t:"Introduction & Interview",tm:"4â€“5 min",c:"#4ECDC4",d:"èº«è¿‘ãªãƒˆãƒ”ãƒƒã‚¯ã«ã¤ã„ã¦ã®è³ªå•"},{n:2,t:"Individual Long Turn",tm:"3â€“4 min",c:"#FF6B6B",d:"ã‚«ãƒ¼ãƒ‰ã®ãƒˆãƒ”ãƒƒã‚¯ã§1â€“2åˆ†ã‚¹ãƒ”ãƒ¼ãƒ"},{n:3,t:"Two-way Discussion",tm:"4â€“5 min",c:"#FFE66D",d:"Part 2ã«é–¢é€£ã—ãŸæŠ½è±¡çš„ãªè­°è«–"}].map(x=>(
            <div key={x.n} style={{display:"flex",alignItems:"center",gap:14,padding:"16px 18px",background:"rgba(255,255,255,.03)",border:"1px solid rgba(255,255,255,.06)",borderRadius:14}}>
              <div className="mono" style={{width:38,height:38,borderRadius:10,background:`${x.c}15`,border:`1px solid ${x.c}30`,display:"flex",alignItems:"center",justifyContent:"center",fontWeight:700,fontSize:15,color:x.c,flexShrink:0}}>{x.n}</div>
              <div style={{flex:1,minWidth:0}}><div style={{fontWeight:600,fontSize:14,marginBottom:2}}>{x.t}</div><div style={{fontSize:11,color:"rgba(255,255,255,.35)"}}>{x.d}</div></div>
              <span className="mono" style={{fontSize:11,color:"rgba(255,255,255,.3)",flexShrink:0}}>{x.tm}</span>
            </div>
          ))}
        </div>

        <div style={{display:"flex",flexDirection:"column",gap:8,width:"100%",marginBottom:28,padding:"16px 18px",background:"rgba(255,255,255,.03)",border:"1px solid rgba(255,255,255,.06)",borderRadius:14}}>
          <div style={{fontSize:12,fontWeight:600,color:"rgba(255,255,255,.5)",marginBottom:4}}>ğŸ“± ä½¿ã„æ–¹</div>
          <div style={{fontSize:12,color:"rgba(255,255,255,.35)",lineHeight:1.8}}>
            â‘  è³ªå•ãŒè¡¨ç¤º â†’ ğŸ”Šã§èª­ã¿ä¸Šã’<br/>
            â‘¡ ğŸ¤ã‚’ã‚¿ãƒƒãƒ—ã—ã¦éŒ²éŸ³é–‹å§‹<br/>
            â‘¢ è‹±èªã§å›ç­” â†’ æ¬¡ã¸é€²ã‚€<br/>
            â‘£ ãƒ†ã‚¹ãƒˆå¾Œã«ã‚»ãƒ«ãƒ•è©•ä¾¡ï¼†éŒ²éŸ³å†ç”Ÿ
          </div>
        </div>

        <button className="btn" onClick={start} style={{width:"100%",maxWidth:300,padding:"16px 28px",borderRadius:14,background:"linear-gradient(135deg,#4ECDC4,#44B8B0)",color:"#0a0a0f",fontSize:15,fontWeight:700,letterSpacing:.5,boxShadow:"0 8px 32px rgba(78,205,196,.3)"}}>ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã™ã‚‹ â†’</button>

        <button className="btn" onClick={()=>setTips(!tips)} style={{marginTop:16,background:"none",border:"none",color:"rgba(255,255,255,.35)",fontSize:12,textDecoration:"underline",textDecorationColor:"rgba(255,255,255,.15)",textUnderlineOffset:4}}>
          {tips?"é–‰ã˜ã‚‹":"ğŸ’¡ é«˜å¾—ç‚¹ã®ã‚³ãƒ„"}
        </button>
        {tips&&<div style={{marginTop:14,padding:"18px 20px",background:"rgba(255,255,255,.03)",border:"1px solid rgba(255,255,255,.08)",borderRadius:14,fontSize:12,lineHeight:2,color:"rgba(255,255,255,.55)"}}>
          <div style={{fontWeight:600,color:"#4ECDC4",marginBottom:6,fontSize:13}}>ã‚¹ã‚³ã‚¢ã‚¢ãƒƒãƒ—ã®ã‚³ãƒ„</div>
          âœ¦ ãƒ•ãƒ«ã‚»ãƒ³ãƒ†ãƒ³ã‚¹ã§ç­”ãˆã‚‹<br/>âœ¦ ç†ç”±ã‚„å…·ä½“ä¾‹ã‚’æ·»ãˆã‚‹<br/>âœ¦ å¤šæ§˜ãªèªå½™ã¨æ–‡æ³•ã‚’ä½¿ã†<br/>âœ¦ Part 2ã¯2åˆ†é–“è©±ã—åˆ‡ã‚‹<br/>âœ¦ Part 3ã¯è³›å¦ä¸¡é¢ã‹ã‚‰è­°è«–<br/>âœ¦ è¨€ã„ç›´ã—ãƒ»è¨€ã„æ›ãˆã‚‚OK
        </div>}
      </div>
    </div>
  );

  // â•â•â• TEST â•â•â•
  if(scr==="test"){
    const qs=getQs();
    return(
      <div className="app">
        <div className="bg" style={{background:`radial-gradient(ellipse at 30% 20%,${pc}08 0%,transparent 60%)`}}/>
        <style>{`@keyframes rec-pulse{0%,100%{box-shadow:0 0 20px ${pc}30}50%{box-shadow:0 0 50px ${pc}60}}`}</style>
        <div className="cnt" key={aKey}>
          {/* Header */}
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}>
            <div style={{display:"flex",alignItems:"center",gap:12}}>
              <div className="mono" style={{padding:"5px 12px",background:`${pc}15`,border:`1px solid ${pc}40`,borderRadius:8,fontSize:12,fontWeight:700,color:pc}}>PART {part}</div>
              {part!==2&&<span style={{fontSize:12,color:"rgba(255,255,255,.3)"}}>Q{qi+1}/{qs.length}</span>}
            </div>
            <div style={{display:"flex",gap:6,alignItems:"center"}}>
              <button className="btn" onClick={()=>setAr(!ar)} style={{padding:"5px 10px",borderRadius:7,background:ar?"rgba(78,205,196,.12)":"rgba(255,255,255,.04)",color:ar?"#4ECDC4":"rgba(255,255,255,.3)",fontSize:10,fontWeight:600,display:"flex",alignItems:"center",gap:3}}>
                ğŸ”Š{ar?"ON":"OFF"}
              </button>
              <button className="btn" onClick={skp} style={{padding:"7px 14px",background:"rgba(255,255,255,.06)",border:"1px solid rgba(255,255,255,.1)",borderRadius:8,color:"rgba(255,255,255,.5)",fontSize:11,fontWeight:500}}>
                {part===3?"çµ‚äº†":`Part ${part+1} â†’`}
              </button>
            </div>
          </div>

          {/* Progress */}
          <div style={{display:"flex",gap:3,marginBottom:22}}>
            {[1,2,3].map(x=><div key={x} style={{flex:1,height:3,borderRadius:2,background:x<part?pc:x===part?`${pc}80`:"rgba(255,255,255,.08)"}}/>)}
          </div>

          <div className="fi">
          {part===2&&prep?(
            <div>
              <div style={{fontSize:10,fontWeight:700,letterSpacing:2.5,textTransform:"uppercase",color:pc,marginBottom:14}}>ğŸ“ PREPARATION TIME</div>
              <div style={{padding:22,background:"rgba(255,255,255,.03)",border:`1px solid ${pc}20`,borderRadius:14,marginBottom:20}}>
                <h2 className="serif" style={{fontSize:18,fontWeight:700,marginBottom:16,lineHeight:1.4}}>{s2.topic}</h2>
                <div style={{fontSize:12,color:"rgba(255,255,255,.4)",marginBottom:10}}>You should say:</div>
                {s2.points.map((pt,i)=><div key={i} style={{padding:"6px 0",fontSize:13,color:"rgba(255,255,255,.7)",display:"flex",gap:8}}><span style={{color:pc}}>â€¢</span>{pt}</div>)}
              </div>
              <button className="btn" onClick={()=>readQ(`${s2.topic}. You should say: ${s2.points.join(". ")}.`)} style={{width:"100%",padding:11,marginBottom:14,background:"rgba(255,255,255,.04)",border:"1px solid rgba(255,255,255,.1)",borderRadius:10,color:"rgba(255,255,255,.5)",fontSize:12,display:"flex",alignItems:"center",justifyContent:"center",gap:6}}>
                {spk?"ğŸ”Š èª­ã¿ä¸Šã’ä¸­...":"ğŸ”Š ã‚«ãƒ¼ãƒ‰ã‚’èª­ã¿ä¸Šã’ã‚‹"}
              </button>
              <Timer sec={prepS} max={60} label="PREP" color={pc}/>
              <button className="btn" onClick={skPrep} style={{marginTop:16,width:"100%",padding:13,background:`${pc}15`,border:`1px solid ${pc}30`,borderRadius:12,color:pc,fontSize:13,fontWeight:600}}>æº–å‚™å®Œäº† â€” éŒ²éŸ³é–‹å§‹</button>
            </div>
          ):(
            <div>
              <div style={{fontSize:10,fontWeight:700,letterSpacing:2.5,textTransform:"uppercase",color:pc,marginBottom:14}}>
                {part===1?s1?.topic:part===2?"YOUR TALK":"DISCUSSION"}
              </div>

              {part===2?(
                <div style={{padding:"18px 20px",background:"rgba(255,255,255,.03)",border:`1px solid ${pc}15`,borderRadius:14,marginBottom:20}}>
                  <h2 className="serif" style={{fontSize:18,fontWeight:700,lineHeight:1.4,marginBottom:8}}>{s2.topic}</h2>
                  <div style={{fontSize:11,color:"rgba(255,255,255,.35)"}}>1ã€œ2åˆ†é–“ã§è©±ã—ã¦ãã ã•ã„</div>
                </div>
              ):(
                <div style={{display:"flex",alignItems:"flex-start",gap:10,marginBottom:20}}>
                  <h2 className="serif" style={{fontSize:20,fontWeight:700,lineHeight:1.5,flex:1}}>{qs[qi]}</h2>
                  <button className="btn" onClick={()=>readQ(qs[qi])} style={{width:38,height:38,borderRadius:10,flexShrink:0,background:spk?`${pc}20`:"rgba(255,255,255,.06)",color:spk?pc:"rgba(255,255,255,.4)",fontSize:16,display:"flex",alignItems:"center",justifyContent:"center"}}>ğŸ”Š</button>
                </div>
              )}

              {spk&&<div style={{display:"flex",alignItems:"center",gap:7,padding:"9px 14px",background:"rgba(78,205,196,.06)",border:"1px solid rgba(78,205,196,.15)",borderRadius:10,marginBottom:14,fontSize:12,color:"#4ECDC4"}}>
                <div style={{width:8,height:8,borderRadius:"50%",background:"#4ECDC4",animation:"pulse 1.5s ease-in-out infinite"}}/>Examiner is speaking...
              </div>}

              {rec&&<div style={{marginBottom:16}}><Timer sec={sec} max={maxT} label={part===2?"SPEAKING":"RESPONSE"} color={pc}/></div>}

              {rec?(
                <div>
                  {micErr&&<div style={{padding:"10px 14px",background:"rgba(255,107,107,.08)",border:"1px solid rgba(255,107,107,.2)",borderRadius:10,fontSize:12,color:"#FF6B6B",marginBottom:14}}>âš ï¸ {micErr}</div>}

                  {/* Waveform */}
                  <div style={{display:"flex",justifyContent:"center",marginBottom:14}}>
                    <Waveform aRef={anRef} active={micRec} color={pc}/>
                  </div>

                  {/* Mic indicator */}
                  <div style={{display:"flex",justifyContent:"center",marginBottom:16}}>
                    <div style={{width:66,height:66,borderRadius:"50%",background:`radial-gradient(circle,${pc} 0%,${pc}80 100%)`,color:"#0a0a0f",fontSize:26,display:"flex",alignItems:"center",justifyContent:"center",animation:"rec-pulse 2s ease-in-out infinite"}}>
                      ğŸ¤
                    </div>
                  </div>
                  <div style={{textAlign:"center",fontSize:12,color:"rgba(255,255,255,.4)",marginBottom:20}}>
                    {micRec?<span style={{color:pc}}>â— REC</span>:""} éŒ²éŸ³ä¸­â€¦ è‹±èªã§å›ç­”ã—ã¦ãã ã•ã„
                  </div>

                  <button className="btn" onClick={nxt} style={{width:"100%",padding:"14px 18px",background:pc,borderRadius:12,color:"#0a0a0f",fontSize:14,fontWeight:700}}>
                    {part===3&&qi===qs.length-1?"ãƒ†ã‚¹ãƒˆå®Œäº† âœ“":part!==2&&qi<qs.length-1?"æ¬¡ã®è³ªå• â†’":part===2?"Part 3 ã¸ â†’":`Part ${part+1} ã¸ â†’`}
                  </button>
                </div>
              ):(
                <button className="btn" onClick={stRec} style={{width:"100%",padding:16,background:`${pc}15`,border:`2px dashed ${pc}30`,borderRadius:14,color:pc,fontSize:14,fontWeight:600,display:"flex",alignItems:"center",justifyContent:"center",gap:8}}>
                  <span style={{fontSize:18}}>ğŸ¤</span>ã‚¿ãƒƒãƒ—ã—ã¦éŒ²éŸ³é–‹å§‹
                </button>
              )}
            </div>
          )}
          </div>

          <div style={{marginTop:"auto",paddingTop:24,textAlign:"center",fontSize:11,color:"rgba(255,255,255,.2)"}}>
            {part===1&&"Part 1: 2ã€œ3æ–‡ã§çŸ­ãç­”ãˆã¾ã—ã‚‡ã†"}
            {part===2&&(prep?"ãƒ¡ãƒ¢ã‚’å–ã£ã¦æ•´ç†ã—ã¾ã—ã‚‡ã†":"1ã€œ2åˆ†é–“ã€é•·ãè©±ã—ç¶šã‘ã¾ã—ã‚‡ã†")}
            {part===3&&"Part 3: æ„è¦‹ï¼‹ç†ç”±ï¼‹ä¾‹ã§è­°è«–ã—ã¾ã—ã‚‡ã†"}
          </div>
        </div>
      </div>
    );
  }

  // â•â•â• REVIEW â•â•â•
  if(scr==="review"){
    const score=getScore();const band=getBand();
    return(
      <div className="app">
        <div className="bg" style={{background:"radial-gradient(ellipse at 50% 30%,rgba(78,205,196,.06) 0%,transparent 60%)"}}/>
        <div className="cnt fi" key={aKey} style={{paddingBottom:40}}>
          <div style={{textAlign:"center",marginBottom:28}}>
            <div style={{fontSize:10,fontWeight:700,letterSpacing:3.5,textTransform:"uppercase",color:"rgba(255,255,255,.3)",marginBottom:14}}>TEST COMPLETE</div>
            <div style={{fontSize:36,marginBottom:8}}>ğŸ‰</div>
            <h2 className="serif" style={{fontSize:24,fontWeight:900,marginBottom:6}}>ãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼</h2>
            <p style={{fontSize:13,color:"rgba(255,255,255,.4)"}}>éŒ²éŸ³ã‚’èãè¿”ã—ã¦ã€ã‚»ãƒ«ãƒ•è©•ä¾¡ã—ã¾ã—ã‚‡ã†</p>
          </div>

          {/* Recordings */}
          {recordings.length>0&&(
            <div style={{marginBottom:28}}>
              <div style={{fontSize:12,fontWeight:700,color:"#4ECDC4",marginBottom:12,letterSpacing:1}}>ğŸ§ éŒ²éŸ³ã®å†ç”Ÿ</div>
              <div style={{display:"flex",flexDirection:"column",gap:6}}>
                {recordings.map((r,i)=>(
                  <button key={i} className="btn" onClick={()=>playRec(i)} style={{display:"flex",alignItems:"center",gap:12,padding:"12px 14px",background:playingIdx===i?"rgba(78,205,196,.1)":"rgba(255,255,255,.03)",border:`1px solid ${playingIdx===i?"rgba(78,205,196,.3)":"rgba(255,255,255,.06)"}`,borderRadius:10,width:"100%",textAlign:"left"}}>
                    <div style={{width:32,height:32,borderRadius:8,background:playingIdx===i?"#4ECDC4":"rgba(255,255,255,.08)",color:playingIdx===i?"#0a0a0f":"rgba(255,255,255,.5)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,flexShrink:0}}>
                      {playingIdx===i?"â¸":"â–¶"}
                    </div>
                    <div style={{flex:1,minWidth:0}}>
                      <div style={{fontSize:12,fontWeight:600,color:"rgba(255,255,255,.7)"}}>Part {r.part} â€” Q{r.qi+1}</div>
                      <div className="mono" style={{fontSize:10,color:"rgba(255,255,255,.3)"}}>{r.duration}ç§’</div>
                    </div>
                  </button>
                ))}
              </div>
            </div>
          )}

          {/* Self-eval checklist */}
          <div style={{marginBottom:24}}>
            <div style={{fontSize:12,fontWeight:700,color:"#FFE66D",marginBottom:14,letterSpacing:1}}>ğŸ“‹ ã‚»ãƒ«ãƒ•è©•ä¾¡ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ</div>
            <p style={{fontSize:11,color:"rgba(255,255,255,.35)",marginBottom:16,lineHeight:1.6}}>éŒ²éŸ³ã‚’èãè¿”ã—ãªãŒã‚‰ã€å½“ã¦ã¯ã¾ã‚‹é …ç›®ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦ãã ã•ã„ã€‚</p>
            {CHECKLIST.map((cat,ci)=>{
              const catColors=["#4ECDC4","#FF6B6B","#FFE66D","#A78BFA"];
              const cc=catColors[ci];
              return(
                <div key={ci} style={{marginBottom:16}}>
                  <div style={{fontSize:11,fontWeight:700,color:cc,marginBottom:8,display:"flex",alignItems:"center",gap:6}}>
                    <div style={{width:4,height:4,borderRadius:2,background:cc}}/>{cat.cat}
                  </div>
                  {cat.items.map((item,ii)=>{
                    const k=`${cat.cat}-${ii}`;const checked=!!checks[k];
                    return(
                      <button key={ii} className="btn" onClick={()=>toggleCheck(cat.cat,ii)} style={{display:"flex",alignItems:"center",gap:10,padding:"10px 12px",marginBottom:4,background:checked?`${cc}08`:"transparent",border:`1px solid ${checked?`${cc}25`:"rgba(255,255,255,.06)"}`,borderRadius:10,width:"100%",textAlign:"left"}}>
                        <div style={{width:20,height:20,borderRadius:6,border:`2px solid ${checked?cc:"rgba(255,255,255,.15)"}`,background:checked?cc:"transparent",display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,color:"#0a0a0f",flexShrink:0,transition:"all .2s"}}>
                          {checked&&"âœ“"}
                        </div>
                        <span style={{fontSize:12,color:checked?"rgba(255,255,255,.7)":"rgba(255,255,255,.4)",transition:"color .2s"}}>{item}</span>
                      </button>
                    );
                  })}
                </div>
              );
            })}
          </div>

          {/* Score */}
          <div style={{padding:"22px 20px",background:"rgba(255,255,255,.03)",border:"1px solid rgba(255,255,255,.08)",borderRadius:14,marginBottom:24,textAlign:"center"}}>
            <div style={{fontSize:11,color:"rgba(255,255,255,.35)",marginBottom:10}}>ã‚»ãƒ«ãƒ•è©•ä¾¡ã‚¹ã‚³ã‚¢</div>
            <div style={{display:"flex",alignItems:"center",justifyContent:"center",gap:16,marginBottom:12}}>
              <span className="mono" style={{fontSize:36,fontWeight:700,color:"#4ECDC4"}}>{score}%</span>
              <div style={{textAlign:"left"}}>
                <div style={{fontSize:12,color:"rgba(255,255,255,.5)"}}>æ¨å®šãƒãƒ³ãƒ‰</div>
                <div className="mono" style={{fontSize:18,fontWeight:700,color:"#FFE66D"}}>{band}</div>
              </div>
            </div>
            <div style={{height:5,background:"rgba(255,255,255,.06)",borderRadius:3,overflow:"hidden"}}>
              <div style={{width:`${score}%`,height:"100%",background:"linear-gradient(90deg,#4ECDC4,#FFE66D)",borderRadius:3,transition:"width .5s"}}/>
            </div>
          </div>

          <button className="btn" onClick={()=>{setScr("home");setPart(0);setRecordings([]);setChecks({});}} style={{width:"100%",padding:16,borderRadius:14,background:"linear-gradient(135deg,#4ECDC4,#44B8B0)",color:"#0a0a0f",fontSize:14,fontWeight:700,boxShadow:"0 8px 32px rgba(78,205,196,.25)"}}>ã‚‚ã†ä¸€åº¦ç·´ç¿’ã™ã‚‹ â†»</button>
        </div>
      </div>
    );
  }
  return null;
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
